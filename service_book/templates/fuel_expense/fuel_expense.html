{% extends 'base.html' %}
{% load dict_extras %}

{% block title %} Fuel expense {% endblock %}

{% block content %}
    <h3>📉Fuel left in tank and average consumption per car </h3>
    {% if cars %}
    <table class="table table-dark table-striped align-middle text-center">
        <thead>
          <tr>
            <th>Car</th>
            <th>Fuel left</th>
            <th>Current average cons.(per 100km)</th>
            <th>Total costs per auto($)</th>
          </tr>
        </thead>
        <tbody>
       {% for car in cars %}
  <tr>
    <td>{{ car }}</td>
    <td>{{ car.fuel_left|default:"0.00" }}</td>
    <td>{{ car.avg_cons|floatformat:2 }}</td>
    <td>{{ costs_dict|get_item:car.id | floatformat:1|default:"0" }}</td>
  </tr>
{% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>You haven't fuel expenses yet</p>
    {% endif %}

    <h3>⛽Your fuel expenses</h3>
<a>Your total fuel amount: {{ total_fuel }}l || total fuel costs: {{ user_total_fuel_costs }}$ || Total refuels: {{ total_refuels }}</a>
    {% if fuel %}
    <table class="table table-dark table-striped align-middle text-center">
        <thead>
          <tr>
            <th>Date</th>
            <th>Car</th>
            <th>Mileage(km)</th>
            <th>Fuel type</th>
            <th>Fuel_amount</th>
            <th>Price($)</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for item in fuel %}
          <tr>
            <td>{{ item.date }}</td>
            <td>{{ item.car }}</td>
            <td>{{ item.miliage }}</td>
            <td>{{ item.fuel_type }}</td>
            <td>{{ item.fuel_amount }}</td>
            <td>{{ item.price }}</td>
            <td>{{ item.description }}</td>
            <td>
              <a href="{% url 'edit_fuel_expense' item.pk %}" class="btn btn-sm btn-warning">✏️Edit</a>
              <form action="{% url 'delete_fuel_expense' item.pk %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger"
                onclick="return confirm('Are you sure you want to delete this record?');">
                🗑️Delete
                </button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
    </table>
        <a href="{% url 'export_fuel_csv' %}" class="btn btn-outline-primary btn-sm">💾Download Fuel expenses (CSV)</a>
    {% else %}
        <p>You haven't fuel expenses yet</p>
    {% endif %}
    <a href="{% url 'add_fuel_expense' %}" class="btn btn-primary btn-sm my-2">✏️ Add fuel expense</a>

{% endblock %}